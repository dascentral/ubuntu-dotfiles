#!/bin/sh

#===================================================================================
# Laravel - Storage Folder
#===================================================================================
#
# DESCRIPTION
# Script that recreates the Laravel "storage" folder structure and adjust
# permissions if specified.
#
#===================================================================================

# Confirm we have a storage folder to evaluate
if [ ! -e "./storage" ]; then
    printf "\033[1;33m\nStorage folder does not exist.\n\n\033[0m"
    exit 0;
fi

# Create folders as necessary
if [ ! -e "./storage/app" ]; then
    mkdir -p storage/app
fi
if [ ! -e "./storage/app/public" ]; then
    mkdir -p storage/app/public
fi
if [ ! -e "./storage/framework/cache" ]; then
    mkdir -p storage/framework/cache
fi
if [ ! -e "./storage/framework/sessions" ]; then
    mkdir -p storage/framework/sessions
fi
if [ ! -e "./storage/framework/views" ]; then
    mkdir -p storage/framework/views
fi
if [ ! -e "./storage/logs" ]; then
    mkdir -p storage/logs
fi

# Set proper permissions
sudo chown -R ${USER} storage
sudo chgrp -R www-data storage
sudo chmod 775 storage
cd storage
find . -type d -exec chmod 775 {} \;
find . -type f -exec chmod 664 {} \;
cd ..
