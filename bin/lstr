#!/bin/sh

#===================================================================================
# Laravel - Storage Folder
#===================================================================================
#
# DESCRIPTION
# Script that recreates the Laravel "storage" folder structure and adjust
# permissions if specified.
#
#===================================================================================

# Confirm we're in a Laravel folder
if [ ! -e "./composer.json" ]; then
    printf "\033[1;33mThis does not appear to be a Laravel application.\033[0m\n"
    exit 1;
fi

# Create folders as necessary
if [ ! -e "./storage" ]; then
    mkdir -p storage
fi
if [ ! -e "./storage/app" ]; then
    mkdir -p storage/app
fi
if [ ! -e "./storage/app/public" ]; then
    mkdir -p storage/app/public
fi
if [ ! -e "./storage/framework/cache" ]; then
    mkdir -p storage/framework/cache
fi
if [ ! -e "./storage/framework/sessions" ]; then
    mkdir -p storage/framework/sessions
fi
if [ ! -e "./storage/framework/views" ]; then
    mkdir -p storage/framework/views
fi
if [ ! -e "./storage/logs" ]; then
    mkdir -p storage/logs
fi

# Set proper permissions
sudo chown -R ${USER} storage
sudo chgrp -R www-data storage
sudo chmod 775 storage
cd storage
find . -type d -exec chmod 775 {} \;
find . -type f -exec chmod 664 {} \;
cd ..
